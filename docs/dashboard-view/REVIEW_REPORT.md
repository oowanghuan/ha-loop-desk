# Expert Review Report

> 功能：dashboard-view
> 阶段：Phase 4 Design
> 评审时间：2024-12-30T21:10:00+08:00
> 评审员：Claude Opus 4

---

## 评审结论

**REVISE** - 设计方案整体合理，架构清晰，但存在 5 个 WARN 级问题需要修复或补充。

---

## 问题摘要

| 级别 | 数量 |
|------|------|
| Block | 0 |
| Warn | 5 |
| Info | 1 |
| **总计** | **6** |

---

## 评审亮点

1. **架构清晰**：Renderer/Main 分层明确，数据流向清晰
2. **组件设计完整**：每个组件都有 Props/Emits 定义
3. **复用现有基础设施**：Schema Discovery、IPC 机制
4. **任务拆分合理**：12 个任务有依赖关系，便于并行开发

---

## 详细问题列表

### WARN 级问题

#### WARN-001: standup 计算逻辑未实现

**位置**: Section 3.1 useDashboard.ts, Lines 342-346

**问题**: standup computed 中仅有注释占位，没有实际实现逻辑

**影响**: 开发时缺少明确实现指导

**修复建议**:
```typescript
const standup = computed(() => {
  const highlights: StandupItem[] = []
  const blockers: BlockerItem[] = []
  const tomorrow: PlanItem[] = []
  const today = new Date().toISOString().split('T')[0]

  for (const feature of store.features) {
    // 提取今日完成的任务
    if (feature.lastUpdated?.startsWith(today)) {
      highlights.push({
        featureId: feature.id,
        featureName: feature.name,
        summary: `${feature.currentPhaseName} 阶段进行中`
      })
    }

    // 提取阻塞任务
    if (feature.status === 'blocked') {
      blockers.push({
        featureId: feature.id,
        featureName: feature.name,
        issue: '待确认阻塞原因',
        blockedSince: feature.lastUpdated || today
      })
    }
  }

  return { highlights, blockers, tomorrow }
})
```

---

#### WARN-002: 缺少 loading/error 状态 UI

**位置**: Section 2.1 DashboardView.vue template

**问题**: useDashboard 返回 loading 和 error，但模板中未使用

**修复建议**:
```vue
<template>
  <div class="dashboard-view">
    <!-- Loading State -->
    <div v-if="loading" class="dashboard-loading">
      <el-icon class="is-loading"><Loading /></el-icon>
      <span>加载项目数据...</span>
    </div>

    <!-- Error State -->
    <div v-else-if="error" class="dashboard-error">
      <el-icon><WarningFilled /></el-icon>
      <span>{{ error }}</span>
      <el-button @click="refresh">重试</el-button>
    </div>

    <!-- Normal Content -->
    <template v-else>
      <DailyStandupPanel ... />
      <DashboardToolbar ... />
      <div class="dashboard-content">...</div>
    </template>
  </div>
</template>
```

---

#### WARN-003: 路由参数兼容性

**位置**: Section 7 路由配置

**问题**: 新路由使用 featureId，与现有 WorkspaceView 的参数可能不兼容

**修复建议**: 在设计文档中补充 WorkspaceView 的修改说明：

```markdown
### WorkspaceView 修改

1. Props 变更：
   - 移除：projectPath
   - 新增：featureId (string), phaseId? (number)

2. 数据加载变更：
   - 根据 featureId 定位 docs/{featureId}/ 目录
   - 加载对应的 90_PROGRESS_LOG.yaml
```

---

#### WARN-004: YAML 解析缺少错误处理

**位置**: Section 5.2 scanFeatures 函数

**问题**: 单个 YAML 解析失败会中断整个扫描

**修复建议**:
```typescript
async function scanFeatures(docsPath: string): Promise<ScanResult> {
  const features: RawFeature[] = []
  const warnings: string[] = []

  for (const entry of entries) {
    try {
      const content = await fs.readFile(progressLogPath, 'utf-8')
      const parsed = yaml.parse(content)
      features.push({ id: entry.name, ...parsed })
    } catch (e) {
      warnings.push(`Failed to parse ${entry.name}: ${e.message}`)
    }
  }

  return { features, warnings }
}
```

---

#### WARN-005: 工具函数未定义

**位置**: Section 5.2 Handler 实现

**问题**: extractPhases 和 getPhaseNameById 函数被调用但未定义

**修复建议**: 补充函数定义：
```typescript
const PHASE_NAMES: Record<number, string> = {
  1: 'Kickoff',
  2: 'Spec',
  3: 'Demo',
  4: 'Design',
  5: 'Code',
  6: 'Test',
  7: 'Deploy'
}

function getPhaseNameById(phaseId: number): string {
  return PHASE_NAMES[phaseId] || `Phase ${phaseId}`
}

function extractPhases(feature: RawFeature): PhaseStatus[] {
  const phases: PhaseStatus[] = []
  for (let i = 1; i <= 7; i++) {
    const phaseKey = `phase_${i}_${PHASE_NAMES[i]?.toLowerCase()}`
    const phaseData = feature[phaseKey]
    phases.push({
      phaseId: i,
      phaseName: PHASE_NAMES[i],
      status: phaseData?.status || 'pending',
      progress: calculatePhaseProgress(phaseData)
    })
  }
  return phases
}
```

---

### INFO 级问题

#### INFO-001: 子组件设计缺失

**位置**: Section 8 文件结构

**问题**: GanttHeader.vue 和 PhaseBar.vue 在文件结构中列出但组件设计未包含

**影响**: 轻微，不影响主体实现

---

## 下一步操作

1. **修复 WARN 级问题** - 建议在进入 Code 阶段前修复
2. **INFO 级问题可选修复** - 可在开发过程中补充
3. 修复后可直接进入 Code 阶段，无需重新评审

---

_Generated by /expert-review | 2024-12-30T21:10:00+08:00_
